{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RVR & JC Grade Calculator</title>
    <link rel="stylesheet" href="{% static 'calculator/style.css' %}" />
    <link rel="shortcut icon" href="https://in.images.search.yahoo.com/images/view;_ylt=AwrKGKPL1zdpSf8_Wmq9HAx.;_ylu=c2VjA3NyBHNsawNpbWcEb2lkAzJlZjM0YjVlNTNhMTY3MWMyNTE4ZDQ0NjI1MTkxMjRiBGdwb3MDMgRpdANiaW5n?back=https%3A%2F%2Fin.images.search.yahoo.com%2Fsearch%2Fimages%3Fp%3Drvr%2Bjc%2Bloogo%26type%3DE210IN714G0%26fr%3Dmcafee%26fr2%3Dpiv-web%26tab%3Dorganic%26ri%3D2&w=223&h=249&imgurl=rvrjcce.ac.in%2Fexamcell%2Fresults%2Fimages%2FRVRJC-Estd-2.jpg&rurl=http%3A%2F%2Frvrjcce.ac.in%2Fexamcell%2Fresults%2Findex.php&size=27KB&p=rvr+jc+loogo&oid=2ef34b5e53a1671c2518d4462519124b&fr2=piv-web&fr=mcafee&tt=RVR%26JC+CE-EXAMS+SECTION&b=0&ni=21&no=2&ts=&tab=organic&sigr=C5EPAFKisGyC&sigb=AUqeW7DWVCl0&sigi=.tWB5xApDNeJ&sigt=GlmkBjlYGyY0&.crumb=tsz7xQAA3fE&fr=mcafee&fr2=piv-web&type=E210IN714G0" type="image/x-icon">
    <style>
      body {
        background: #f0f4f8;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #333;
        margin: 0;
        padding: 20px 10px;
        display: flex;
        justify-content: center;
        min-height: 100vh;
      }

      .container {
        background: linear-gradient(145deg, #ffffff, #e0f7fa);
        border: 2px solid #00acc1;
        border-radius: 16px;
        padding: 30px;
        max-width: 600px;
        width: 100%;
        box-shadow: 0 8px 24px rgba(0, 172, 193, 0.2);
        margin: 20px 0;
      }

      h2 {
        text-align: center;
        color: #00796b;
        margin-bottom: 25px;
      }

      .choice-buttons {
        display: flex;
        gap: 15px;
        margin-bottom: 25px;
      }

      .choice-btn {
        flex: 1;
        padding: 14px;
        font-size: 1.1rem;
        background-color: #00bcd4;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
      }

      .choice-btn:hover {
        background-color: #4dd0e1;
        transform: translateY(-2px);
      }

      .choice-btn.active {
        background-color: #00796b;
        box-shadow: 0 4px 12px rgba(0, 121, 107, 0.3);
      }

      .form-row {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }

      .form-row label {
        flex: 0 0 200px;
        font-weight: 500;
        color: #333;
      }

      .form-row input,
      .form-row select {
        flex: 1;
        padding: 10px 12px;
        font-size: 1rem;
        border: 1px solid #bbb;
        border-radius: 8px;
        background-color: #fff;
        transition: border 0.3s;
      }

      .form-row input:focus,
      .form-row select:focus {
        outline: none;
        border-color: #00acc1;
        box-shadow: 0 0 0 2px rgba(0, 172, 193, 0.2);
      }

      button[type="submit"] {
        margin-top: 25px;
        padding: 14px;
        width: 100%;
        font-size: 1.1rem;
        background-color: #00796b;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        font-weight: 500;
      }

      button[type="submit"]:hover {
        background-color: #009688;
      }

      .subject-row {
        margin-bottom: 18px;
        padding: 15px;
        background-color: #f8fdff;
        border-radius: 8px;
        border: 1px solid #e0f2f1;
      }

      .subject-name {
        font-weight: 600;
        color: #00796b;
        margin-bottom: 8px;
        font-size: 1.05rem;
      }

      .credit-info {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 10px;
      }

      .subject-select {
        width: 100%;
        padding: 10px;
        border: 1px solid #bbb;
        border-radius: 8px;
        background-color: white;
        font-size: 1rem;
      }

      .hidden {
        display: none;
      }

      .footer {
        margin-top: 30px;
        padding: 20px;
        text-align: center;
        background-color: #e1f5fe;
        border-radius: 12px;
        font-size: 0.95rem;
        border: 1px solid #81d4fa;
      }

      .footer p {
        margin: 5px 0;
      }

      .footer a {
        margin: 0 10px;
        color: #00796b;
        text-decoration: none;
        font-weight: 500;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      .cgpa-form-row {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }

      .cgpa-form-row label {
        flex: 0 0 200px;
        font-weight: 500;
      }

      .cgpa-form-row input {
        flex: 1;
        padding: 10px 12px;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 8px;
      }

      .info-message {
        background-color: #e3f2fd;
        border: 1px solid #2196f3;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 20px;
        text-align: center;
        color: #1565c0;
        font-size: 0.95rem;
      }

      .semester-container {
        background-color: #f8fdff;
        border: 1px solid #b2ebf2;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
      }

      .semester-title {
        color: #00796b;
        font-weight: 600;
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      .result-display {
        background-color: #e8f5e9;
        border: 2px solid #4caf50;
        border-radius: 8px;
        padding: 15px;
        margin: 20px 0;
        text-align: center;
        font-weight: 600;
        color: #2e7d32;
        font-size: 1.2rem;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h2>RVR & JC Semester GPA Calculator</h2>

      <!-- Choice Buttons -->
      <div class="choice-buttons">
        <button class="choice-btn active" onclick="showSGPA()">
          Calculate SGPA
        </button>
        <button class="choice-btn" onclick="showCGPA()">Calculate CGPA</button>
      </div>

      <!-- SGPA Form -->
      <div id="sgpa-section">
        <form id="basic-info-form">
          {% csrf_token %}

          <div class="info-message">
            Enter your basic details to proceed with SGPA calculation
          </div>

          <div class="form-row">
            <label for="name">Name:</label>
            <input type="text" id="name" required />
          </div>

          <div class="form-row">
            <label for="regno">Register Number:</label>
            <input type="text" id="regno" required />
          </div>

          <div class="form-row">
            <label for="branch">Select Branch:</label>
            <select id="branch" required>
              <option value="">-- Select Branch --</option>
              <option value="cse">CSE</option>
              <option value="csd">CSD</option>
              <option value="csbs">CSBS</option>
              <option value="csm">CSM</option>
              <option value="it">IT</option>
              <option value="ece">ECE</option>
              <option value="eee">EEE</option>
              <option value="civ">CIV</option>
              <option value="che">CHE</option>
              <option value="mec">MEC</option>
            </select>
          </div>

          <button type="submit">Next → Enter Grades</button>
        </form>

        <form id="grade-form" class="hidden" method="POST">
          {% csrf_token %}
          <input type="hidden" name="name" id="name-hidden" />
          <input type="hidden" name="reg_number" id="regno-hidden" />
          <input type="hidden" name="branch" id="branch-hidden" />
          <input type="hidden" name="calculation_type" value="sgpa" />

          <div class="info-message">
            Select grades for each subject. All fields are required.
          </div>

          <div id="subjects-container"></div>
          <input type="hidden" id="sgpa-hidden" name="sgpa" />
          <button type="submit">Calculate SGPA</button>
        </form>
      </div>

      <!-- CGPA Form -->
      <div id="cgpa-section" class="hidden">
        <form id="cgpa-form" method="POST">
          {% csrf_token %}

          <div class="info-message">
            Enter your details and semester GPAs to calculate CGPA
          </div>

          <div class="form-row">
            <label for="cgpa-name">Name:</label>
            <input type="text" id="cgpa-name" name="name" required />
          </div>

          <div class="form-row">
            <label for="cgpa-regno">Register Number:</label>
            <input type="text" id="cgpa-regno" name="reg_number" required />
          </div>

          <div class="form-row">
            <label for="cgpa-branch">Select Branch:</label>
            <select id="cgpa-branch" name="branch" required>
              <option value="">-- Select Branch --</option>
              <option value="cse">CSO / CSE</option>
              <option value="csd">CSD</option>
              <option value="csbs">CSBS</option>
              <option value="csm">CSM</option>
              <option value="it">IT</option>
              <option value="ece">ECE</option>
              <option value="eee">EEE</option>
              <option value="civ">CIV</option>
              <option value="che">CHE</option>
              <option value="mec">MEC</option>
            </select>
          </div>

          <!-- Semester 1 -->
          <div class="semester-container">
            <div class="semester-title">Semester 1 GPA</div>
            <div class="cgpa-form-row">
              <label for="sem1-gpa">Enter GPA:</label>
              <input
                type="number"
                id="sem1-gpa"
                name="sem1_gpa"
                step="0.01"
                min="0"
                max="10"
                required
                placeholder="Enter GPA (0-10)"
              />
            </div>
          </div>

          <!-- Semester 2 -->
          <div class="semester-container">
            <div class="semester-title">Semester 2 GPA</div>
            <div class="cgpa-form-row">
              <label for="sem2-gpa">Enter GPA:</label>
              <input
                type="number"
                id="sem2-gpa"
                name="sem2_gpa"
                step="0.01"
                min="0"
                max="10"
                required
                placeholder="Enter GPA (0-10)"
              />
            </div>
          </div>

          <!-- Semester 3 -->
          <div class="semester-container">
            <div class="semester-title">Semester 3 GPA</div>
            <div class="cgpa-form-row">
              <label for="sem3-gpa">Enter GPA:</label>
              <input
                type="number"
                id="sem3-gpa"
                name="sem3_gpa"
                step="0.01"
                min="0"
                max="10"
                required
                placeholder="Enter GPA (0-10)"
              />
            </div>
          </div>

          <!-- CGPA Result Display -->
          <div id="cgpa-result" class="result-display hidden">
            Calculated CGPA: <span id="cgpa-value">0.00</span>
          </div>

          <input type="hidden" name="calculation_type" value="cgpa" />
          <input type="hidden" id="cgpa-hidden" name="cgpa" />
          <button type="submit">Save CGPA Result</button>
        </form>
      </div>

      <!-- Footer -->
      <div class="footer">
        <p>
          Developed with ❤️ by Akhil Siva Chowdary [Y24CO033] | RVR & JC College
        </p>
        <p>Connect with me:</p>
        <a href="https://www.instagram.com/akhil_23.10/" target="_blank"
          >Instagram</a
        >
        |
        <a
          href="https://www.linkedin.com/in/akhil-siva-chowdary-nandigam-897a99356"
          target="_blank"
          >LinkedIn</a
        >
      </div>
    </div>

    <script>
      const gradeToPoint = { "A+": 10, A: 9, B: 8, C: 7, D: 6, E: 5, F: 0 };

      // Updated subjects with credits for all branches
      const subjects = {
        cse: [
          ["Probability & Statistics", 3],
          ["Universal Human Values", 2],
          ["Discrete Mathematical Structures", 3],
          ["Computer Organization", 3],
          ["Design & Analysis of Algorithms", 3],
          ["Object Oriented Programming System", 3],
          ["Skill Enhancement Course", 2],
          ["DAA Lab", 1.5],
          ["OOPS Lab", 1.5],
        ],
        csd: [
          ["Probability & Statistics", 3],
          ["Universal Human Values", 2],
          ["Discrete Mathematical Structures", 3],
          ["Computer Organization", 3],
          ["Data Visualization", 3],
          ["Object Oriented Programming ", 3],
          ["Skill Enhancement Course", 2],
          [" Business Communication and Value ScienceLab", 1][("OOPS Lab", 1)],
          ["Data Visualization Lab", 1],
        ],
        csbs: [
          [" Computational Statistics", 3],
          ["Universal Human Values", 2],
          ["Computer Organization & Architecture", 3],
          [" Formal Languages and Automata Theory", 3],
          ["Design & Analysis of Algorithms", 3],
          ["Object Oriented Programming ", 3],
          ["Skill Enhancement Course", 2],
          ["Computational Statistics Lab", 1],
          ["OOPS Lab", 1],
          ["Business Communication and Value Science-III Lab", 1],
        ],
        csm: [
          ["Probability & Statistics", 3],
          ["Universal Human Values", 2],
          ["Discrete Mathematical Structures", 3],
          ["Computer Organization", 3],
          ["Design & Analysis of Algorithms", 3],
          ["Object Oriented Programming System", 3],
          ["Skill Enhancement Course", 2],
          ["DAA Lab", 1.5],
          ["OOPS Lab", 1.5],
        ],
        it: [
          ["Probability & Statistics", 3],
          ["Universal Human Values", 2],
          ["Discrete Mathematical Structures", 3],
          ["Computer Organization", 3],
          ["Design & Analysis of Algorithms", 3],
          ["Object Oriented Programming System", 3],
          ["Skill Enhancement Course", 2],
          ["DAA Lab", 1.5],
          ["OOPS Lab", 1.5],
        ],
        ece: [
          ["Probability & Statistics", 3],
          ["Digital Systems", 3],
          ["Digital Electronics", 3],
          ["Signals & Systems", 3],
          ["Analog Circuits", 3],
          ["Skill Enhancement Course", 2],
          ["Design Thinking and Innovation", 2],
          ["Digital Systems Lab", 1],
          ["Digital Electronics Lab", 1.5],
        ],
        eee: [
          ["Probability & Statistics", 3],
          ["Digital Systems", 3],
          ["Electrical Circuit Analysis", 3],
          ["Electronic Devices & Circuits", 3],
          ["DC Machines", 3],
          ["Skill Enhancement Course", 2],
          ["Design Thinking and Innovation", 2],
          ["Digital Systems Lab", 1],
          ["DC Machines Lab", 1],
        ],
        civ: [
          ["Probability & Statistics", 3],
          ["Engineering Geology & GIS", 2],
          ["Water Supply Engineering", 3],
          ["Fluid Mechanics", 3],
          ["Solid Mechanics-I", 3],
          ["Building Materials & Building Construction", 2],
          ["Skill Enhancement Course", 2],
          ["Design Thinking and Innovation", 2],
          ["Engineering Geology & GIS Lab", 1],
          ["Material Testing Lab", 1],
        ],
        che: [
          ["Probability & Statistics", 3],
          ["Organic Chemistry", 3],
          ["Chemical Engineering Thermodynamics", 3],
          ["Chemical Process Calculations", 3],
          ["Mechanical Operations", 3],
          ["Skill Enhancement Course", 2],
          ["Design Thinking and Innovation", 2],
          ["Organic Chemistry Lab", 1],
          ["Mechanical Operations Lab", 1],
        ],
        mec: [
          ["Material Science and Metallurgy", 3],
          ["Strength of Materials", 3],
          [" Manufacturing processes", 3],
          ["Basic Thermodynamics", 3],
          ["Kinematics of Machines", 3],
          ["Skill Enhancement Course", 2],
          ["Design Thinking and Innovation", 2],
          ["Machine Drawing Lab", 1.5],
          ["Modeling Lab", 1],
        ],
      };

      function showSGPA() {
        document
          .querySelectorAll(".choice-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");
        document.getElementById("sgpa-section").classList.remove("hidden");
        document.getElementById("cgpa-section").classList.add("hidden");
        // Reset forms
        document.getElementById("basic-info-form").classList.remove("hidden");
        document.getElementById("grade-form").classList.add("hidden");
        document.getElementById("basic-info-form").reset();
      }

      function showCGPA() {
        document
          .querySelectorAll(".choice-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");
        document.getElementById("sgpa-section").classList.add("hidden");
        document.getElementById("cgpa-section").classList.remove("hidden");
        document.getElementById("cgpa-form").reset();
        document.getElementById("cgpa-result").classList.add("hidden");
      }

      document
        .getElementById("basic-info-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const name = document.getElementById("name").value;
          const regno = document.getElementById("regno").value;
          const branch = document.getElementById("branch").value;

          if (!name || !regno || !branch) {
            alert("Please fill all required fields");
            return;
          }

          document.getElementById("name-hidden").value = name;
          document.getElementById("regno-hidden").value = regno;
          document.getElementById("branch-hidden").value = branch;

          const container = document.getElementById("subjects-container");
          container.innerHTML = "";

          // Check if branch exists in subjects
          if (!subjects[branch]) {
            alert(
              "Subjects not defined for selected branch. Please contact administrator."
            );
            return;
          }

          // Create subject inputs
          subjects[branch].forEach(([subjectName, credit], index) => {
            const subjectDiv = document.createElement("div");
            subjectDiv.className = "subject-row";
            subjectDiv.innerHTML = `
          <div class="subject-name">${subjectName}</div>
          <div class="credit-info">Credits: ${credit}</div>
          <select class="subject-select grade-select" data-credit="${credit}" data-subject="${subjectName}" required>
            <option value="">-- Select Grade --</option>
            <option value="A+">A+ (10 points)</option>
            <option value="A">A (9 points)</option>
            <option value="B">B (8 points)</option>
            <option value="C">C (7 points)</option>
            <option value="D">D (6 points)</option>
            <option value="E">E (5 points)</option>
            <option value="F">F (0 points)</option>
          </select>
        `;
            container.appendChild(subjectDiv);
          });

          document.getElementById("basic-info-form").classList.add("hidden");
          document.getElementById("grade-form").classList.remove("hidden");
        });

      document
        .getElementById("grade-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const selects = document.querySelectorAll(".grade-select");
          let totalCredits = 0,
            totalPoints = 0;
          let allFilled = true;

          // Clear any existing hidden inputs
          const existingInputs = document.querySelectorAll(
            'input[name="subjects[]"], input[name="grades[]"], input[name="credits[]"]'
          );
          existingInputs.forEach((input) => input.remove());

          for (let sel of selects) {
            const grade = sel.value;
            const credit = parseFloat(sel.dataset.credit);
            const subjectName = sel.dataset.subject;

            if (!grade) {
              allFilled = false;
              sel.style.borderColor = "#f44336";
              continue;
            } else {
              sel.style.borderColor = "#bbb";
            }

            // Create hidden inputs for subject data
            const subjectInput = document.createElement("input");
            subjectInput.type = "hidden";
            subjectInput.name = "subjects[]";
            subjectInput.value = subjectName;
            this.appendChild(subjectInput);

            const gradeInput = document.createElement("input");
            gradeInput.type = "hidden";
            gradeInput.name = "grades[]";
            gradeInput.value = grade;
            this.appendChild(gradeInput);

            const creditInput = document.createElement("input");
            creditInput.type = "hidden";
            creditInput.name = "credits[]";
            creditInput.value = credit;
            this.appendChild(creditInput);

            totalPoints += gradeToPoint[grade] * credit;
            totalCredits += credit;
          }

          if (!allFilled) {
            alert("Please select grades for all subjects");
            return;
          }

          if (totalCredits === 0) {
            alert("Error: Total credits cannot be zero");
            return;
          }

          const sgpa = (totalPoints / totalCredits).toFixed(2);
          document.getElementById("sgpa-hidden").value = sgpa;

          // Show confirmation and submit

          this.submit();
        });

      // Function to calculate CGPA from 3 semesters
      function calculateCGPA() {
        const sem1Gpa =
          parseFloat(document.getElementById("sem1-gpa").value) || 0;
        const sem2Gpa =
          parseFloat(document.getElementById("sem2-gpa").value) || 0;
        const sem3Gpa =
          parseFloat(document.getElementById("sem3-gpa").value) || 0;

        // Validate inputs
        const allValid = [sem1Gpa, sem2Gpa, sem3Gpa].every(
          (gpa) => !isNaN(gpa) && gpa >= 0 && gpa <= 10
        );

        if (!allValid) {
          return null;
        }

        // Calculate average of 3 semesters
        const cgpa = ((sem1Gpa + sem2Gpa + sem3Gpa) / 3).toFixed(2);
        return cgpa;
      }

      // Update CGPA display in real-time
      function updateCGPADisplay() {
        const cgpa = calculateCGPA();
        if (cgpa !== null) {
          document.getElementById("cgpa-value").textContent = cgpa;
          document.getElementById("cgpa-result").classList.remove("hidden");
          document.getElementById("cgpa-hidden").value = cgpa;
        } else {
          document.getElementById("cgpa-result").classList.add("hidden");
        }
      }

      // Add event listeners to GPA inputs for real-time calculation
      document
        .getElementById("sem1-gpa")
        .addEventListener("input", updateCGPADisplay);
      document
        .getElementById("sem2-gpa")
        .addEventListener("input", updateCGPADisplay);
      document
        .getElementById("sem3-gpa")
        .addEventListener("input", updateCGPADisplay);

      document
        .getElementById("cgpa-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const sem1Gpa = parseFloat(document.getElementById("sem1-gpa").value);
          const sem2Gpa = parseFloat(document.getElementById("sem2-gpa").value);
          const sem3Gpa = parseFloat(document.getElementById("sem3-gpa").value);

          if (isNaN(sem1Gpa) || isNaN(sem2Gpa) || isNaN(sem3Gpa)) {
            alert("Please enter valid GPA values for all semesters");
            return;
          }

          if (
            sem1Gpa < 0 ||
            sem1Gpa > 10 ||
            sem2Gpa < 0 ||
            sem2Gpa > 10 ||
            sem3Gpa < 0 ||
            sem3Gpa > 10
          ) {
            alert("GPA values must be between 0 and 10");
            return;
          }

          const cgpa = calculateCGPA();
          if (cgpa === null) {
            alert("Please enter valid GPA values");
            return;
          }

          document.getElementById("cgpa-hidden").value = cgpa;

          // Show confirmation and submit

          this.submit();
        });

      // Initialize with SGPA form
      document.addEventListener("DOMContentLoaded", function () {
        showSGPA();
      });
    </script>
  </body>
</html>
